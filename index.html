<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>QR Scanner</title>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body style="font-family:Arial;text-align:center;padding:20px">

<h2>QR Scanner</h2>

<button onclick="startScan()">ðŸ“· Ð¡ÐºÐ°Ð½ÑƒÐ²Ð°Ñ‚Ð¸ QR</button><br><br>
<button onclick="sendData()">ðŸ“¤ Ð’Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð¸Ñ‚Ð¸ Ð´Ð°Ð½Ñ–</button>

<div id="reader" style="margin-top:20px;"></div>
<p id="result">Ð”Ð°Ð½Ñ– Ñ‰Ðµ Ð½Ðµ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ñ–</p>

<script>
let scannedData = "";
let html5QrCode;

function startScan() {
  html5QrCode = new Html5Qrcode("reader");

  Html5Qrcode.getCameras().then(cameras => {

    // ðŸ”´ ÑˆÑƒÐºÐ°Ñ”Ð¼Ð¾ Ð·Ð°Ð´Ð½ÑŽ ÐºÐ°Ð¼ÐµÑ€Ñƒ
    let backCamera = cameras.find(cam =>
      cam.label.toLowerCase().includes("back") ||
      cam.label.toLowerCase().includes("rear")
    );

    // ÑÐºÑ‰Ð¾ Ð½Ðµ Ð·Ð½Ð°Ð¹ÑˆÐ»Ð¸ â€” Ð±ÐµÑ€ÐµÐ¼Ð¾ Ð¾ÑÑ‚Ð°Ð½Ð½ÑŽ
    const cameraId = backCamera ? backCamera.id : cameras[cameras.length - 1].id;

    html5QrCode.start(
      cameraId,
      { fps: 10, qrbox: 250 },
      qr => {
        scannedData = qr;
        document.getElementById("result").innerText = qr;
        html5QrCode.stop();
      }
    );
  });
}
</script>


function sendData() {
  if (!scannedData) {
    alert("Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð²Ñ–Ð´ÑÐºÐ°Ð½ÑƒÐ¹Ñ‚Ðµ QR");
    return;
  }

  fetch("https://script.google.com/macros/s/AKfycbwMiHwQPVkA9TJDdXYeEX8JEFi4N6U9iiwrLffUAIhya_U9JzxdvFupa3dUyP4vnKSbSA/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ qr_data: scannedData })
  })
  .then(() => alert("Ð”Ð°Ð½Ñ– Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾"))
  .catch(() => alert("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ°"));
}
</script>

</body>
</html>


